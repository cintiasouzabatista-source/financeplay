<!DOCTYPE html>
<html lang="pt-BR">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>Minhas Finan√ßas</title>

  <!-- Anti-cache b√°sico (ajuda em deploys, mas n√£o substitui limpar SW/caches) -->
  <meta http-equiv="Cache-Control" content="no-cache, no-store, must-revalidate" />
  <meta http-equiv="Pragma" content="no-cache" />
  <meta http-equiv="Expires" content="0" />

  <style>
    :root{
      --bg:#f5f5f5;
      --card:#ffffff;
      --text:#0f172a;
      --muted:#64748b;
      --side:#111827;
      --sideHover:rgba(255,255,255,.08);
      --sideActive:rgba(99,102,241,.28);
      --primary:#6366f1;
      --danger:#ef4444;
      --radius:10px;
    }
    *{box-sizing:border-box}
    body { font-family: Arial, sans-serif; background:var(--bg); margin:0; color:var(--text); }
    .layout{display:flex; min-height:100vh;}
    .sidebar { width:240px; background:var(--side); color:white; padding:18px 16px; position:fixed; inset:0 auto 0 0; overflow:auto; }
    .brand{display:flex; align-items:center; justify-content:space-between; gap:10px; margin-bottom:14px;}
    .brand h2 { font-size:18px; margin:0; }
    .version { font-size:12px; opacity:0.65; }
    .nav{margin-top:10px; display:flex; flex-direction:column; gap:6px;}
    .nav a{
      display:flex; align-items:center; gap:10px;
      color:white; text-decoration:none; padding:10px 12px;
      border-radius:10px; transition:.15s ease;
    }
    .nav a:hover{background:var(--sideHover);}
    .nav a.active{background:var(--sideActive); outline:1px solid rgba(99,102,241,.35);}
    .nav .spacer{height:10px;}
    .main { margin-left:240px; padding:20px; width:100%; }
    .header{display:flex; align-items:flex-end; justify-content:space-between; gap:12px; margin-bottom:14px;}
    .title{font-size:20px; margin:0;}
    .subtitle{font-size:13px; color:var(--muted); margin:4px 0 0 0;}
    .card { background:var(--card); padding:18px; border-radius:var(--radius); box-shadow:0 2px 8px rgba(0,0,0,.06); margin-bottom:14px; }
    .row{display:flex; align-items:center; justify-content:space-between; gap:12px; padding:12px 0; border-bottom:1px solid rgba(15,23,42,.08);}
    .row:last-child{border-bottom:none}
    .row .label{font-weight:700}
    .row .desc{font-size:12px; color:var(--muted); margin-top:3px}
    button { padding:10px 14px; border:none; border-radius:10px; cursor:pointer; }
    .btn-primary { background:var(--primary); color:white; }
    .btn-danger { background:var(--danger); color:white; }
    .btn-muted { background:rgba(15,23,42,.06); color:var(--text); }
    input, select{
      width:100%; max-width:320px;
      padding:10px 12px; border-radius:10px;
      border:1px solid rgba(15,23,42,.15); background:#fff;
    }
    .grid{display:grid; grid-template-columns:repeat(auto-fit, minmax(260px, 1fr)); gap:12px;}
    .pill{display:inline-flex; align-items:center; gap:8px; padding:7px 10px; border-radius:999px; background:rgba(99,102,241,.10); border:1px solid rgba(99,102,241,.18); color:var(--text); font-size:12px;}
    .note{font-size:13px; color:var(--muted); line-height:1.35;}
    @media (max-width: 900px){
      .sidebar{position:static; width:100%; height:auto;}
      .main{margin-left:0}
      .layout{flex-direction:column}
    }
  </style>

  <script>
    // Vers√£o vis√≠vel para confirmar deploy
    window.__BUILD_ID__ = "v2026.02.20-03";

    function clearAppCache(){
      try{
        if ('serviceWorker' in navigator) {
          navigator.serviceWorker.getRegistrations().then(function(registrations) {
            for (let registration of registrations) registration.unregister();
          });
        }
        if ('caches' in window) {
          caches.keys().then(function(names) {
            for (let name of names) caches.delete(name);
          });
        }
      }catch(e){}
      alert("Cache limpo. O app ser√° recarregado.");
      // location.reload(true) √© deprecated; usamos reload normal + cache-buster
      const url = new URL(location.href);
      url.searchParams.set("v", window.__BUILD_ID__ + "-" + Date.now());
      location.href = url.toString();
    }

    function confirmAndClearData(){
      const typed = prompt('A√ß√£o irrevers√≠vel. Digite "LIMPAR" para confirmar:');
      if (typed !== "LIMPAR") return alert("Cancelado.");
      // Aqui voc√™ pode integrar sua l√≥gica real de limpar dados (IndexedDB/localStorage).
      // Nesta vers√£o simples, limpamos localStorage como exemplo.
      try{ localStorage.clear(); }catch(e){}
      alert("Dados apagados.");
      location.reload();
    }

    function renderPage(page){
      const titleEl = document.getElementById("pageTitle");
      const subEl = document.getElementById("pageSubtitle");
      const mainEl = document.getElementById("pageBody");

      // ativa link
      document.querySelectorAll(".nav a[data-page]").forEach(a=>{
        a.classList.toggle("active", a.getAttribute("data-page") === page);
      });

      const pages = {
        dashboard: {
          title: "Vis√£o Geral",
          sub: "Resumo r√°pido do m√™s e do seu saldo.",
          html: `
            <div class="grid">
              <div class="card">
                <div class="pill">üí∞ Saldo</div>
                <h3 style="margin:10px 0 0 0;">R$ 0,00</h3>
                <p class="note">Voc√™ pode conectar isso ao seu c√°lculo real depois.</p>
              </div>
              <div class="card">
                <div class="pill">üõ° Reserva</div>
                <h3 style="margin:10px 0 0 0;">R$ 0,00</h3>
                <p class="note">Reserva separada do dia a dia.</p>
              </div>
            </div>
          `
        },
        transactions: {
          title: "Transa√ß√µes",
          sub: "Entradas, sa√≠das e transfer√™ncias.",
          html: `<div class="card"><p class="note">Tela de transa√ß√µes (placeholder nesta vers√£o).</p></div>`
        },
        accounts: {
          title: "Contas",
          sub: "Gerencie suas contas e saldos.",
          html: `<div class="card"><p class="note">Tela de contas (placeholder nesta vers√£o).</p></div>`
        },
        cards: {
          title: "Cart√µes",
          sub: "Controle de faturas e parcelas.",
          html: `<div class="card"><p class="note">Tela de cart√µes (placeholder nesta vers√£o).</p></div>`
        },
        reports: {
          title: "Relat√≥rios",
          sub: "Resumo e an√°lises.",
          html: `<div class="card"><p class="note">Tela de relat√≥rios (placeholder nesta vers√£o).</p></div>`
        },
        graphs: {
          title: "Gr√°ficos",
          sub: "Visualiza√ß√µes (fica fora da tela inicial para manter tudo limpo).",
          html: `<div class="card"><p class="note">Aqui entram os gr√°ficos semestrais/anuais quando integrarmos no app completo.</p></div>`
        },
        data: {
          title: "Dados",
          sub: "√Årea t√©cnica: exportar, importar e limpar.",
          html: `
            <div class="card">
              <div class="row">
                <div>
                  <div class="label">Exportar Dados</div>
                  <div class="desc">Baixar seus dados em formato JSON</div>
                </div>
                <button class="btn-primary" onclick="alert('Exportar: conecte aqui sua fun√ß√£o real.')">Exportar</button>
              </div>
              <div class="row">
                <div>
                  <div class="label">Importar Dados</div>
                  <div class="desc">Carregar dados de um arquivo JSON (substitui dados atuais)</div>
                </div>
                <button class="btn-primary" onclick="alert('Importar: conecte aqui sua fun√ß√£o real.')">Importar</button>
              </div>
              <div class="row">
                <div>
                  <div class="label">Limpar Dados</div>
                  <div class="desc">Remover todos os dados do aplicativo (a√ß√£o irrevers√≠vel)</div>
                </div>
                <button class="btn-danger" onclick="confirmAndClearData()">Limpar</button>
              </div>
              <div class="row">
                <div>
                  <div class="label">Limpar Cache do App</div>
                  <div class="desc">Resolve tela desatualizada (Service Worker / cache)</div>
                </div>
                <button class="btn-danger" onclick="clearAppCache()">Limpar Cache</button>
              </div>
            </div>
          `
        },
        plans: {
          title: "Planos",
          sub: "√Årea de administra√ß√£o (separada do perfil/configura√ß√µes).",
          html: `
            <div class="card">
              <div class="row" style="align-items:flex-start">
                <div style="flex:1; min-width:180px;">
                  <div class="label">Per√≠odo</div>
                  <div class="desc">Mensal / Semestral / Anual</div>
                </div>
                <select id="planPeriod">
                  <option value="mensal">Mensal</option>
                  <option value="semestral">Semestral</option>
                  <option value="anual">Anual</option>
                </select>
              </div>
              <div class="row" style="align-items:flex-start">
                <div style="flex:1; min-width:180px;">
                  <div class="label">Forma de PGto</div>
                  <div class="desc">Cart√£o / PIX / Boleto</div>
                </div>
                <input id="planPayment" placeholder="Ex.: PIX" />
              </div>
              <div class="row" style="align-items:flex-start">
                <div style="flex:1; min-width:180px;">
                  <div class="label">Status</div>
                  <div class="desc">Ativo / Bloqueado</div>
                </div>
                <select id="planStatus">
                  <option value="ativo">Ativo</option>
                  <option value="bloqueado">Bloqueado</option>
                </select>
              </div>
              <div style="display:flex; justify-content:flex-end; gap:10px; margin-top:14px;">
                <button class="btn-muted" onclick="alert('Cancelar')">Cancelar</button>
                <button class="btn-primary" onclick="savePlanSettings()">Salvar</button>
              </div>
              <p class="note" style="margin-top:12px">Obs.: Nesta vers√£o simples, salvamos no localStorage. No app completo, podemos integrar ao seu storage principal.</p>
            </div>
          `
        },
        settings: {
          title: "Configura√ß√µes",
          sub: "Prefer√™ncias do app. (A se√ß√£o de Planos foi removida daqui).",
          html: `
            <div class="card">
              <p class="note">Configura√ß√µes b√°sicas (placeholder nesta vers√£o).</p>
              <p class="note">‚úÖ ‚ÄúPlanos‚Äù foi movido para o menu lateral.</p>
              <p class="note">‚úÖ ‚ÄúDados‚Äù foi movido para o menu lateral.</p>
            </div>
          `
        }
      };

      const p = pages[page] || pages.dashboard;
      titleEl.textContent = p.title;
      subEl.textContent = p.sub;
      mainEl.innerHTML = p.html;

      // p√≥s-render: preencher dados de Planos se existir
      if(page === "plans"){
        try{
          const saved = JSON.parse(localStorage.getItem("ui_plan_settings") || "null");
          if(saved){
            document.getElementById("planPeriod").value = saved.period || "mensal";
            document.getElementById("planPayment").value = saved.payment || "";
            document.getElementById("planStatus").value = saved.status || "ativo";
          }
        }catch(e){}
      }
    }

    function savePlanSettings(){
      const payload = {
        period: document.getElementById("planPeriod")?.value || "mensal",
        payment: (document.getElementById("planPayment")?.value || "").trim(),
        status: document.getElementById("planStatus")?.value || "ativo"
      };
      localStorage.setItem("ui_plan_settings", JSON.stringify(payload));
      alert("Planos: configura√ß√µes salvas.");
    }

    function initNav(){
      document.querySelectorAll(".nav a[data-page]").forEach(a=>{
        a.addEventListener("click", (e)=>{
          e.preventDefault();
          const page = a.getAttribute("data-page");
          const url = new URL(location.href);
          url.hash = page;
          history.pushState({}, "", url.toString());
          renderPage(page);
        });
      });

      window.addEventListener("popstate", ()=>{
        const page = (location.hash || "#dashboard").replace("#","");
        renderPage(page);
      });

      const initial = (location.hash || "#dashboard").replace("#","");
      renderPage(initial);
    }

    window.addEventListener("DOMContentLoaded", initNav);
  </script>
</head>
<body>
  <div class="layout">
    <aside class="sidebar">
      <div class="brand">
        <h2>Minhas Finan√ßas</h2>
        <div class="version" title="Build ID" id="buildTag"></div>
      </div>

      <nav class="nav">
        <a href="#dashboard" data-page="dashboard" class="active">Vis√£o Geral</a>
        <a href="#transactions" data-page="transactions">Transa√ß√µes</a>
        <a href="#accounts" data-page="accounts">Contas</a>
        <a href="#cards" data-page="cards">Cart√µes</a>
        <a href="#reports" data-page="reports">Relat√≥rios</a>

        <!-- Gr√°ficos: abaixo de Relat√≥rios (como voc√™ pediu) -->
        <a href="#graphs" data-page="graphs">Gr√°ficos</a>

        <div class="spacer"></div>

        <!-- Dados e Planos ficam na lateral (√°reas t√©cnicas/admin) -->
        <a href="#data" data-page="data">Dados</a>
        <a href="#plans" data-page="plans">Planos</a>

        <a href="#settings" data-page="settings">Configura√ß√µes</a>
      </nav>

      <div class="version" style="margin-top:14px;">
        <span id="buildTag2"></span>
      </div>
    </aside>

    <main class="main">
      <div class="header">
        <div>
          <h1 class="title" id="pageTitle">Vis√£o Geral</h1>
          <p class="subtitle" id="pageSubtitle">Resumo r√°pido do m√™s e do seu saldo.</p>
        </div>
        <span class="pill" id="buildPill"></span>
      </div>

      <section id="pageBody"></section>
    </main>
  </div>

  <script>
    // carimbo vis√≠vel
    document.getElementById("buildTag").textContent = window.__BUILD_ID__;
    document.getElementById("buildTag2").textContent = window.__BUILD_ID__;
    document.getElementById("buildPill").textContent = "Build " + window.__BUILD_ID__;
  </script>
</body>
</html>
